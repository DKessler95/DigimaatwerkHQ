<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digimaatwerk CMS</title>
  <link rel="icon" href="/favicon.ico" />
  <!-- Import Decap CMS -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <style>
    :root {
      --midnight-blue: #0F172A;
      --dark-gray: #1E293B;
      --teal: #0D9488;
      --teal-light: #14B8A6;
      --white: #FFFFFF;
    }
    
    /* Override Decap CMS styles to match our theme */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }
    
    /* Loading screen styles */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--midnight-blue);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease-out;
    }
    
    .loading-text {
      color: var(--white);
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: 600;
    }
    
    .spinner {
      border: 5px solid rgba(255,255,255,0.1);
      border-radius: 50%;
      border-top: 5px solid var(--teal);
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Custom CSS for admin dashboard */
    .custom-sidebar-header {
      background-color: var(--midnight-blue);
      padding: 16px;
      text-align: center;
    }
    
    .custom-sidebar-header h1 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
  </style>
</head>
<body>
  <!-- Loading screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-text">Loading CMS...</div>
    <div class="spinner"></div>
  </div>
  
  <script>
    // Check if user is logged in
    async function checkAuth() {
      try {
        const response = await fetch('/admin/api/auth/check', {
          credentials: 'include'
        });
        
        if (!response.ok) {
          // Redirect to login if not authenticated
          window.location.href = '/admin/login.html';
        } else {
          // User is authenticated, hide loading screen
          setTimeout(() => {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
              loadingScreen.style.opacity = '0';
              setTimeout(() => {
                loadingScreen.style.display = 'none';
              }, 500);
            }
          }, 1000);
        }
      } catch (error) {
        console.error('Auth check error:', error);
        window.location.href = '/admin/login.html';
      }
    }
    
    // Configure Decap CMS
    window.CMS.init({
      config: {
        backend: {
          name: 'test-repo', // For development only, use proxy on local setup
          login: false       // Disable the login feature since we're handling auth separately
        },
        media_folder: 'public/uploads',
        public_folder: '/uploads',
        logo_url: '/logo.svg',
        site_url: '/',
        display_url: 'https://digimaatwerk.nl',
        locale: 'nl',
        collections: [
          {
            name: 'services',
            label: 'Diensten',
            folder: 'public/content/services',
            create: true,
            i18n: {
              structure: 'multiple_files',
              locales: ['nl', 'en']
            },
            slug: '{{slug}}',
            fields: [
              { label: 'Titel', name: 'title', widget: 'string', i18n: true },
              { label: 'Icoon', name: 'icon', widget: 'string', hint: 'Icoon code, bijv. "code" voor code-icoon', i18n: true },
              { label: 'Korte Beschrijving', name: 'short_description', widget: 'text', i18n: true },
              { label: 'Hoofdafbeelding', name: 'featured_image', widget: 'image', i18n: true },
              { label: 'Volgorde', name: 'order', widget: 'number', default: 0, value_type: 'int', min: 0, max: 999 },
              { 
                label: 'Functies', 
                name: 'features', 
                widget: 'list', 
                i18n: true,
                fields: [
                  { label: 'Naam', name: 'name', widget: 'string' },
                  { label: 'Beschrijving', name: 'description', widget: 'text' }
                ]
              },
              { 
                label: 'Tech Stack', 
                name: 'tech_stack', 
                widget: 'list', 
                i18n: true,
                fields: [
                  { label: 'Naam', name: 'name', widget: 'string' },
                  { label: 'Beschrijving', name: 'description', widget: 'text' }
                ]
              },
              { label: 'Inhoud', name: 'content', widget: 'markdown', i18n: true }
            ]
          },
          {
            name: 'case-studies',
            label: 'Case Studies',
            folder: 'public/content/case-studies',
            create: true,
            i18n: {
              structure: 'multiple_files',
              locales: ['nl', 'en']
            },
            slug: '{{slug}}',
            fields: [
              { label: 'Titel', name: 'title', widget: 'string', i18n: true },
              { label: 'Afbeelding', name: 'featured_image', widget: 'image', i18n: true },
              { label: 'Categorie', name: 'category', widget: 'select', options: ['AI & Chatbots', 'Automatisering', 'Web Development'], i18n: true },
              { label: 'Klant', name: 'client', widget: 'string', i18n: true },
              { label: 'Industrie', name: 'industry', widget: 'string', i18n: true },
              { label: 'Datum', name: 'date', widget: 'datetime', format: 'YYYY-MM-DD', i18n: true },
              { label: 'Beschrijving', name: 'description', widget: 'text', i18n: true },
              { label: 'Uitdaging', name: 'challenge', widget: 'text', i18n: true },
              { label: 'Oplossing', name: 'solution', widget: 'text', i18n: true },
              { label: 'Resultaat', name: 'result', widget: 'text', i18n: true },
              { 
                label: 'Metrics', 
                name: 'metrics', 
                widget: 'list', 
                i18n: true,
                fields: [
                  { label: 'Label', name: 'label', widget: 'string' },
                  { label: 'Waarde', name: 'value', widget: 'string' }
                ]
              },
              { label: 'Uitgelicht', name: 'featured', widget: 'boolean', default: false, i18n: true },
              { label: 'Inhoud', name: 'content', widget: 'markdown', i18n: true }
            ]
          },
          {
            name: 'blog',
            label: 'Blog',
            folder: 'public/content/blog',
            create: true,
            i18n: {
              structure: 'multiple_files',
              locales: ['nl', 'en']
            },
            slug: '{{slug}}',
            fields: [
              { label: 'Titel', name: 'title', widget: 'string', i18n: true },
              { label: 'Afbeelding', name: 'featured_image', widget: 'image', i18n: true },
              { label: 'Auteur', name: 'author', widget: 'string', i18n: true },
              { label: 'Datum', name: 'date', widget: 'datetime', format: 'YYYY-MM-DD', i18n: true },
              { label: 'CategorieÃ«n', name: 'categories', widget: 'list', i18n: true },
              { label: 'Tags', name: 'tags', widget: 'list', i18n: true },
              { label: 'Samenvatting', name: 'excerpt', widget: 'text', i18n: true },
              { label: 'Inhoud', name: 'content', widget: 'markdown', i18n: true }
            ]
          }
        ]
      }
    });
    
    // Run auth check
    checkAuth();
  </script>
</body>
</html>